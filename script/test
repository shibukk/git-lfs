#!/bin/sh
#/ Usage: script/test          # run all tests
#/        script/test <subdir> # run just a package's tests

script/fmt
script/bootstrap

git config user.name || git config user.name "Git LFS Tests"
git config user.email || git config user.email "git-lfs@example.com"

export LOCALSRCDIR=`pwd`/.vendor/src/github.com/github/git-lfs
mkdir -p `dirname $LOCALSRCDIR`
rm -f $LOCALSRCDIR
ln -s `pwd` $LOCALSRCDIR

GOPATH="`pwd`/.vendor"
SUITE="./${1:-"..."}"
if [ $# -gt 0 ]; then
  shift
fi
PATH=$LOCALSRCDIR/bin:$PATH GOPATH=$GOPATH go test $SUITE -i "$@"
PATH=$LOCALSRCDIR/bin:$PATH GOPATH=$GOPATH go test $SUITE "$@"

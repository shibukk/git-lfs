#!/bin/sh
#/ Usage: script/test          # run all tests
#/        script/test <subdir> # run just a package's tests

target="./..."

if [[ "$#" != "0" ]]; then
  target="./$@"
fi

script/fmt
script/bootstrap

mkdir -p `pwd`/.vendor/src/github.com/github
rm -f `pwd`/.vendor/src/github.com/github/git-media
ln -s `pwd` `pwd`/.vendor/src/github.com/github/git-media

GOPATH="`pwd`/.vendor" go test $target -i
GOPATH="`pwd`/.vendor" go test $target

rm -f `pwd`/.vendor/src/github.com/github/git-media

#!/bin/sh

. "test/testenv.sh"

atexit() {
  if [ -s "$REMOTEDIR/gitserver.log" ]; then
    echo ""
    echo "gitserver.log:"
    cat "$REMOTEDIR/gitserver.log"
  fi

  echo ""
  echo "env:"
  env

  SHUTDOWN_LFS=yes
  GITSERVER=$(cat "$LFS_URL_FILE")
  shutdown
  rm -rf $TRASHDIR
}

trap "atexit" EXIT

if [ -s "$LFS_URL_FILE" ]; then
  echo "$LFS_URL_FILE still exists!"
  exit 1
fi

setup

echo "run some tests, yo"

test/test-happy-path.sh
